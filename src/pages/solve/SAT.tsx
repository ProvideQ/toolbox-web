import { Divider, Heading, Spacer, Text } from "@chakra-ui/react";
import type { NextPage } from "next";
import Head from "next/head";
import { useState } from "react";
import { baseUrl } from "../../api/ToolboxAPI";
import { Layout } from "../../components/layout/Layout";
import { EditorControls } from "../../components/solvers/EditorControls";
import { SAT_language } from "../../components/solvers/SAT/prism-SAT";
import { SyntaxHighlightedTextarea } from "../../components/solvers/SAT/SyntaxHighlightedTextarea";
import { SolverConfiguration } from "../../components/solvers/SolverConfiguration";
import { LogicalExpressionValidator } from "../../converter/dimacs/LogicalExpressionValidator";

const SAT: NextPage = () => {
  const logicalExpressionValidator = new LogicalExpressionValidator();

  const [logicalExpressionString, setLogicalExpressionString] = useState("");
  const [errorString, setErrorString] = useState("");

  return (
    <Layout>
      <Head>
        <title>ProvideQ</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        {/* TODO: replace favicon */}
      </Head>

      <Heading as="h1">SAT Solver</Heading>
      <Text color="text" align="justify">
        For a given Boolean formula, this algorithm checks if there is an
        interpretation that satisfies it. You can enter any boolean formula with
        any number of variables and combine them with boolean operators (i.e.,
        &quot;and&quot;, &quot;or&quot; and &quot;not&quot;).
      </Text>

      <Spacer />

      <EditorControls
        idleText={'Try "a and (not a or not b)" ðŸ‘‡'}
        errorText={errorString}
        setEditorContent={setLogicalExpressionString}
        editorContent={logicalExpressionString}
        documentationLink={`${baseUrl()}/webjars/swagger-ui/index.html#/sat`}
      />
      <SyntaxHighlightedTextarea
        grammar={SAT_language}
        language="SAT_language"
        problemString={logicalExpressionString}
        setProblemString={(value) => {
          setLogicalExpressionString(value);

          let errors = logicalExpressionValidator.validateLogicalExpression(
            value.toString()
          );

          if (errors) {
            setErrorString(errors.toString());
          } else {
            setErrorString("");
          }
        }}
      />

      <Divider />

      <SolverConfiguration
        problemTypeId="sat"
        problemInput={logicalExpressionString}
      />
    </Layout>
  );
};

export default SAT;
